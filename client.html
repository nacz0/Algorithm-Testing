<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Prosty Test WS</title>
</head>
<body>
    <h2>Kontrola Algorytmu</h2>
    <button onclick="sendStart()">▶ START</button>
    <button onclick="sendStart(true)">⟳ WZNÓW (Resume)</button>
    <button onclick="sendPause()">⏸ PAUZA</button>
    <button onclick="sendStop()">⏹ STOP</button>
    
    <h3>Logi:</h3>
    <pre id="logs" style="background:#eee; padding:10px; height:200px; overflow:auto;"></pre>

    <script>
        // Połączenie przy starcie strony
        const ws = new WebSocket("ws://localhost:8000/ws");

        ws.onopen = () => log("Połączono z serwerem");
        ws.onmessage = (e) => {
            // Jeśli to JSON z postępem, sformatuj go ładnie, jeśli tekst "done" - wypisz
            try {
                const data = JSON.parse(e.data);
                if(data.type === "progress") {
                    log(`Iteracja: ${data.iteration}/${data.total} | Wynik: ${data.best_score.toFixed(5)}`);
                } else {
                    log("Server: " + JSON.stringify(data));
                }
            } catch {
                log("Server: " + e.data);
            }
        };

        function sendStart(resume = false) {
            const payload = {
    "type": "start",
    "data": {
        "resume": resume,
        "algorithms": [
            {
                "name": "Bat alhorithm",
                "args": [{"name": "Agents", "min": 30}, {"name": "Iterations", "min": 200}]
            },
            {
                "name": "Genetic algorytm",
                "args": [{"name": "Agents", "min": 50}, {"name": "Iterations", "min": 150}]
            }
        ]
    }
};
            ws.send(JSON.stringify(payload));
            log("Wysłano: START (Resume: " + resume + ")");
        }

        function sendPause() {
            ws.send(JSON.stringify({"type": "pause"}));
            log("Wysłano: PAUSE");
        }

        function sendStop() {
            ws.send(JSON.stringify({"type": "stop"}));
            log("Wysłano: STOP");
        }

        function log(msg) {
            document.getElementById("logs").innerText = msg + "\n" + document.getElementById("logs").innerText;
        }
    </script>
</body>
</html>